<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sudoku Solver</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
      }
      table {
        margin: 20px auto;
        border-collapse: collapse;
      }
      td {
        width: 30px;
        height: 30px;
        text-align: center;
        border: 1px solid black;
        position: relative;
      }
      input {
        width: 28px;
        height: 28px;
        text-align: center;
        border: none;
      }
      button {
        margin-top: 10px;
        padding: 10px;
      }

      /* Thicker lines for 3x3 grid separation */
      td:nth-child(3n) {
        border-right: 3px solid black;
      }
      tr:nth-child(3n) td {
        border-bottom: 3px solid black;
      }
      td:first-child {
        border-left: 3px solid black;
      }
      tr:first-child td {
        border-top: 3px solid black;
      }
    </style>
  </head>
  <body>
    <h1>Sudoku Solver</h1>
    <table id="sudoku-grid"></table>
    <button onclick="solveSudoku()">Solve</button>

    <script>
      let pyodideReady = false;

      async function loadPyodideAndSetup() {
        try {
          // Load Pyodide
          window.pyodide = await loadPyodide();
          await pyodide.loadPackage("numpy");

          // Replace these with the raw GitHub URLs of your Python files
          let solverResponse = await fetch(
            "https://raw.githubusercontent.com/bergio13/simulated-annealing-sudoku/main/solver.py"
          );
          let solverCode = await solverResponse.text();

          let saResponse = await fetch(
            "https://raw.githubusercontent.com/bergio13/simulated-annealing-sudoku/main/simulated_annealing.py"
          );
          let saCode = await saResponse.text();

          // Run the simulated_annealing.py script first to load its modules
          await pyodide.runPythonAsync(saCode);

          // Then run the solver.py script
          await pyodide.runPythonAsync(solverCode);

          console.log("Pyodide loaded and solver script executed.");
          pyodideReady = true;
        } catch (error) {
          console.error("Failed to load Pyodide or the scripts:", error);
          alert("Failed to load Pyodide. Check the console for details.");
        }
      }

      function createGrid() {
        let table = document.getElementById("sudoku-grid");
        for (let i = 0; i < 9; i++) {
          let row = table.insertRow();
          for (let j = 0; j < 9; j++) {
            let cell = row.insertCell();
            let input = document.createElement("input");
            input.type = "text";
            input.maxLength = 1;
            input.dataset.row = i;
            input.dataset.col = j;
            cell.appendChild(input);
          }
        }
      }
      createGrid();
      loadPyodideAndSetup();

      async function solveSudoku() {
        if (!pyodideReady) {
          alert("Pyodide is still loading. Please wait...");
          return;
        }

        let grid = [];
        for (let i = 0; i < 9; i++) {
          let row = [];
          for (let j = 0; j < 9; j++) {
            let value = document.querySelector(
              `input[data-row='${i}'][data-col='${j}']`
            ).value;
            row.push(value ? parseInt(value) : 0);
          }
          grid.push(row);
        }

        try {
          let pyCode = `solve_sudoku(${JSON.stringify(grid)})`;
          let result = await pyodide.runPythonAsync(pyCode);
          let solvedGrid = JSON.parse(result);

          for (let i = 0; i < 9; i++) {
            for (let j = 0; j < 9; j++) {
              document.querySelector(
                `input[data-row='${i}'][data-col='${j}']`
              ).value = solvedGrid[i][j];
            }
          }
        } catch (error) {
          console.error("Error solving Sudoku:", error);
          alert(
            "An error occurred while solving. Check the console for details."
          );
        }
      }
    </script>
  </body>
</html>
